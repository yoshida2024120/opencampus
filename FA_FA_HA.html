<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>リップルキャリー加算器</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    canvas { border: 1px solid #ccc; background: white; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>

<h1>リップルキャリー加算器</h1>
<canvas id="adderCanvas" width="800" height="750"></canvas>
<br>
<button id="btnA3">入力A3: OFF</button>
<button id="btnA">入力A2: OFF</button>
<button id="btnHAA">入力A1: OFF</button>
&nbsp;&nbsp;
<button id="btnB3">入力B3: OFF</button>
<button id="btnB">入力B2: OFF</button>
<button id="btnHAB">入力B1: OFF</button>

<br>
  <button onclick="window.open('https://yoshida2024120.github.io/opencampus/', '_self')">
    戻る
  </button>


<script>
  let inputA3 = false;
  let inputB3 = false;


  let inputA = false;
  let inputB = false;
  let inputHAA = false;
  let inputHAB = false;

  document.getElementById("btnA3").onclick = function() {
    inputA3 = !inputA3;
    updateButtonLabels();
    drawAdder();
  };


  document.getElementById("btnB3").onclick = function() {
    inputB3 = !inputB3;
    updateButtonLabels();
    drawAdder();
  };

  
  document.getElementById("btnA").onclick = function() {
    inputA = !inputA;
    updateButtonLabels();
    drawAdder();
  };

  document.getElementById("btnHAA").onclick = function() {
    inputHAA = !inputHAA;
    updateButtonLabels();
    drawAdder();
  };

  document.getElementById("btnB").onclick = function() {
    inputB = !inputB;
    updateButtonLabels();
    drawAdder();
  };

  document.getElementById("btnHAB").onclick = function() {
    inputHAB = !inputHAB;
    updateButtonLabels();
    drawAdder();
  };

  function updateButtonLabels() {
    document.getElementById("btnA3").textContent = "入力A3: " + (inputA3 ? "ON" : "OFF");
    document.getElementById("btnB3").textContent = "入力B3: " + (inputB3 ? "ON" : "OFF");
   
    document.getElementById("btnA").textContent = "入力A2: " + (inputA ? "ON" : "OFF");
    document.getElementById("btnHAA").textContent = "入力A1: " + (inputHAA ? "ON" : "OFF");
    document.getElementById("btnB").textContent = "入力B2: " + (inputB ? "ON" : "OFF");
    document.getElementById("btnHAB").textContent = "入力B1: " + (inputHAB ? "ON" : "OFF");
  }

  function drawAdder() {
    const canvas = document.getElementById("adderCanvas");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const onColor = "red";
    const offColor = "gray";
    const lw = 10-2;

    const ha_sum = inputHAA ^ inputHAB;
    const ha_carry = inputHAA && inputHAB;

    const cin = ha_carry;
    const fa_sum = inputA ^ inputB ^ cin;
    const fa_carry = (inputA && inputB) || (inputA && cin) || (inputB && cin);

    const cin2 = fa_carry;
    const fa_sum2 = inputA3 ^ inputB3 ^ cin2;
    const fa_carry2 = (inputA3 && inputB3) || (inputA3 && cin2) || (inputB3 && cin2);


    const FAy = 170;
 

    // === 全加算器の入力線 ===

    //１番目の１番上の入力から一番上のFAの入力A
    ctx.lineWidth = lw;
    ctx.strokeStyle = inputA3 ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(150, 335.5-150); ctx.lineTo(300, 335.5-150); ctx.stroke();
    ctx.fillStyle = inputA3 ? onColor : offColor;
    ctx.font = "40px Arial";
    ctx.fillText(inputA3 ? "1" : "0", 110, 348-150);

    ctx.lineWidth = lw;
    ctx.strokeStyle = cin2 ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(260, 270.5+120-150); ctx.lineTo(300, 270.5+120-150); ctx.stroke(); 
    // 全加算器のCの最後の横線
    ctx.beginPath(); ctx.moveTo(260, 265+120-150); ctx.lineTo(260, 325+120.5-150); ctx.stroke();
    // 全加算器のCの縦線
    ctx.beginPath(); ctx.moveTo(260, 320.5+120-150); ctx.lineTo(475, 320.5+120-150); ctx.stroke();
    // 全加算器のCの横線
    ctx.beginPath(); ctx.moveTo(470, 318.5+120-150); ctx.lineTo(470, 505.5-172); ctx.stroke();
    // 半加算器の上の出力からCへ行くの縦線
    ctx.fillStyle = cin2 ? onColor : offColor;

    ctx.fillStyle = inputB3 ? onColor : offColor;
    ctx.font = "40px Arial";
    ctx.fillText(inputB3 ? "1" : "0", 110, 464);


//１番目の2番上の入力から2番上のFAの入力A
    ctx.lineWidth = lw;
    ctx.strokeStyle = inputA ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(250, 335.5); ctx.lineTo(300, 335.5); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(150, 230.5); ctx.lineTo(254.5, 335.5); ctx.stroke();
    //ctx.beginPath(); ctx.moveTo(150, 335.5); ctx.lineTo(300, 335.5); ctx.stroke();
    ctx.fillStyle = inputA ? onColor : offColor;
    ctx.font = "40px Arial";
    ctx.fillText(inputA ? "1" : "0", 110, 245);

    

    //２番目の1番上の入力から1番上のFAの入力B
    ctx.lineWidth = lw;
    ctx.strokeStyle = inputB3 ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(245, 363.5-150); ctx.lineTo(303, 363.5-150); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(150, 500.5-50); ctx.lineTo(250, 360.5-150); ctx.stroke();
    

    ctx.lineWidth = lw;
    ctx.strokeStyle = inputB ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(245, 363.5); ctx.lineTo(303, 363.5); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(150, 500.5); ctx.lineTo(250, 360.5); ctx.stroke();
    
    ctx.fillStyle = inputB ? onColor : offColor;
    ctx.fillText(inputB ? "1" : "0", 110, 518);

    ctx.lineWidth = lw;
    ctx.strokeStyle = cin ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(260, 270.5+120); ctx.lineTo(300, 270.5+120); ctx.stroke(); 
    // 全加算器のCの最後の横線
    ctx.beginPath(); ctx.moveTo(260, 265+120); ctx.lineTo(260, 325+120.5); ctx.stroke();
    // 全加算器のCの縦線
    ctx.beginPath(); ctx.moveTo(260, 320.5+120); ctx.lineTo(475, 320.5+120); ctx.stroke();
    // 全加算器のCの横線
    ctx.beginPath(); ctx.moveTo(470, 318.5+120); ctx.lineTo(470, 505.5); ctx.stroke();
    // 半加算器の上の出力からCへ行くの縦線
    
    
    ctx.fillStyle = cin ? onColor : offColor;
    //ctx.fillText(cin ? "1" : "0", 110, 518);

    // FA 本体
    
    //いちば上のFA
    ctx.strokeStyle = "black";
    ctx.lineWidth = 5;
    ctx.strokeRect(300, 140+170-150, 100, 100);
    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.fillText("FA", 330, 360-150);

//2番目のFA
    ctx.strokeStyle = "black";
    ctx.lineWidth = 5;
    ctx.strokeRect(300, 140+170, 100, 100);
    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.fillText("FA", 330, 360);

    // 全加算器の出力線

    //一番目のFA
    ctx.lineWidth = lw;
    ctx.strokeStyle = fa_sum2 ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(400, 220.5+FAy-150); ctx.lineTo(550, 220.5+FAy-150); ctx.stroke();
    ctx.fillStyle = "black"; //ctx.fillText("1桁目", 580, 270);
    ctx.fillStyle = fa_sum2 ? onColor : offColor;
    ctx.font = "40px Arial";
    ctx.fillText(fa_sum2 ? "1" : "0", 560, 400-150);

    ctx.lineWidth = lw;
    ctx.strokeStyle = fa_carry2 ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(400, 160.5+FAy-150); ctx.lineTo(550, 160.5+FAy-150); ctx.stroke();
    ctx.fillStyle = "black";// ctx.fillText("2桁目", 580, 150);
    ctx.fillStyle = fa_carry2 ? onColor : offColor;
    ctx.fillText(fa_carry2 ? "1" : "0", 560, 340-150);

    
    //2番目のFA
    ctx.lineWidth = lw;
    ctx.strokeStyle = fa_sum ? onColor : offColor;
    
    //1桁目の出力戦
    ctx.beginPath(); ctx.moveTo(400, 220.5+FAy); ctx.lineTo(550, 220.5+FAy); ctx.stroke();
    ctx.fillStyle = "black"; //ctx.fillText("1桁目", 580, 270);
    ctx.fillStyle = fa_sum ? onColor : offColor;
    ctx.font = "40px Arial";
    ctx.fillText(fa_sum ? "1" : "0", 560, 400);
    265+120-150
    ctx.lineWidth = lw;
    ctx.strokeStyle = fa_carry ? onColor : offColor;
    //ctx.beginPath(); ctx.moveTo(400, 160.5+FAy); ctx.lineTo(550, 160.5+FAy); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(400, 160.5+FAy); ctx.lineTo(400+70, 160.5+FAy); ctx.stroke();
    ctx.fillStyle = "black";// ctx.fillText("2桁目", 580, 150);
    ctx.fillStyle = fa_carry ? onColor : offColor;
    //ctx.fillText(fa_carry ? "1" : "0", 560, 340);

    ctx.fillStyle = "black";
    ctx.font = "40px Arial";

    ctx.fillStyle = inputA3 ? onColor : offColor;

//    ctx.fillText("全加算器: ", 150, 360);
    ctx.fillStyle = inputA ? onColor : offColor;
//    ctx.fillText(inputA ? "1" : "0", 320, 360);
//    ctx.fillStyle = "black"; ctx.fillText("+", 355, 360);
    ctx.fillStyle = inputB ? onColor : offColor;
//    ctx.fillText(inputB ? "1" : "0", 390, 360);
//    ctx.fillText("+", 425, 360);
    ctx.fillStyle = cin ? onColor : offColor;
//    ctx.fillText(cin ? "1" : "0", 460, 360);
//    ctx.fillStyle = "black"; ctx.fillText("=", 495, 360);
    ctx.fillStyle = fa_carry ? onColor : offColor;
//    ctx.fillText(fa_carry ? "1" : "0", 530, 360);
    ctx.fillStyle = fa_sum ? onColor : offColor;
//    ctx.fillText(fa_sum ? "1" : "0", 570, 360);

    // === 半加算器の入力線 ===
    ctx.lineWidth = lw;
    ctx.strokeStyle = inputHAA ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(250, 500.5); ctx.lineTo(300, 500.5); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(150, 275.5); ctx.lineTo(254.5, 503.5); ctx.stroke();
  
    ctx.fillStyle = inputHAA ? onColor : offColor;
    ctx.fillText(inputHAA ? "1" : "0", 110, 290);

    ctx.lineWidth = lw;
    ctx.strokeStyle = inputHAB ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(150, 560.5); ctx.lineTo(300, 560.5); ctx.stroke();
    ctx.fillStyle = inputHAB ? onColor : offColor;
    ctx.fillText(inputHAB ? "1" : "0", 110, 568);

    // HA 本体
    ctx.strokeStyle = "black";
    ctx.lineWidth = 5;
    ctx.strokeRect(300, 480, 100, 100);
    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.fillText("HA", 330, 540);

    // 半加算器の出力線
    ctx.lineWidth = lw;
    ctx.strokeStyle = ha_sum ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(400, 560.5); ctx.lineTo(550, 560.5); ctx.stroke();
    ctx.fillStyle = "black"; //ctx.fillText("1桁目", 580, 560);
    ctx.fillStyle = ha_sum ? onColor : offColor;
    ctx.font = "40px Arial";
    ctx.fillText(ha_sum ? "1" : "0", 560, 570);

    ctx.lineWidth = lw;
    ctx.strokeStyle = ha_carry ? onColor : offColor;
    ctx.beginPath(); ctx.moveTo(400, 500.5); ctx.lineTo(470, 500.5); ctx.stroke();
    ctx.fillStyle = "black"; //ctx.fillText("2桁目", 580, 500);
    ctx.fillStyle = ha_carry ? onColor : offColor;
   // ctx.fillText(ha_carry ? "1" : "0", 560, 510);

   // ctx.fillStyle = "black";
   // ctx.font = "40px Arial";
   // ctx.fillText("半加算器: ", 150, 680);
   // ctx.fillStyle = inputHAA ? onColor : offColor;
   // ctx.fillText(inputHAA ? "1" : "0", 320, 680);
   // ctx.fillStyle = "black"; ctx.fillText("+", 355, 680);
   // ctx.fillStyle = inputHAB ? onColor : offColor;
   // ctx.fillText(inputHAB ? "1" : "0", 390, 680);
   // ctx.fillStyle = "black"; ctx.fillText("=", 430, 680);
   // ctx.fillStyle = ha_carry ? onColor : offColor;
   // ctx.fillText(ha_carry ? "1" : "0", 470, 680);
   // ctx.fillStyle = ha_sum ? onColor : offColor;
   // ctx.fillText(ha_sum ? "1" : "0", 510, 680);

    //let binary1 = (inputA ? 1 : 0)*2  + (inputHAA ? 1 : 0); 
    //let binary2 = (inputB ? 1 : 0)*2  + (inputHAB ? 1 : 0); 
    let binary1 = (inputA3 ? 1 : 0)*4 + (inputA ? 1 : 0)*2  + (inputHAA ? 1 : 0); 
    let binary2 = (inputB3 ? 1 : 0)*4 + (inputB ? 1 : 0)*2  + (inputHAB ? 1 : 0); 
    let binary3 = binary1 + binary2; 

    let decimalStr1 = binary1.toString();        
    let decimalStr2 = binary2.toString();  
    let decimalStr3 = binary3.toString();  
          

// 描画
const x10 = 300
ctx.font = "40px Arial";
ctx.fillStyle = "black";
ctx.fillText("+", 680-x10, 680);
ctx.fillText("10進数:"+ decimalStr1, 210, 680);  // ← ← 座標をここで調整
ctx.fillText( decimalStr2, 730-x10, 680);  // ← ← 座標をここで調整
ctx.fillText("=", 800-x10, 680);
ctx.fillText( decimalStr3, 850-x10, 680);  // ← ← 座標をここで調整

ctx.fillText("+", 113, 375);
   
  }

  updateButtonLabels();
  drawAdder();
</script>

</body>
</html>
